<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

    <script>
      $(document).ready(function(){
        //$('img').nepnyan();
        $('#hoge').nepnyan();
      });
      $(function(){
        //$('img').center();
      });

      /*
        plugins
      */
      (function($){
          $.fn.nepnyan=function(options){
              var opt = $.extend({
                speed: 1000,
                pause: 6000,
                /* 画像の表示% 0~1の間で指定*/
                first_show: 0.4,
                second_show: 0.5,

                LorR : "left",
                marginLorR: "marginLeft"
              }, options);

              if(opt.LorR == "right"){
                opt.marginLorR = "marginRight";
              }

              /*MouseOver時のimgのcss指定*/
              var mouseOverCss = {};
              mouseOverCss[opt.marginLorR] = '0';

              /*通常のimgの動きのcss指定*/
              var imageWidth = $(element).width();
              var normalMoveCss = [];
              normalMoveCss['first_pos'] = {}
              normalMoveCss['first_pos'][opt.marginLorR] = imageWidth*opt.first_show;
              
              normalMoveCss['second_pos'] = {}
              normalMoveCss['second_pos'][opt.marginLorR] = imageWidth*opt.second_show;

              /* 現在の要素をelementに格納 */
              var element = this;
              changeCSS();
              cloudMove();
              setInterval(cloudMove,opt.pause);
              /* ウィンドウがリサイズされた時にもCSSを変更 */
              $(window).bind("resize", function(){
                  changeCSS();
              });
              /* ウィンドウがスクロールされた時にもCSSを変更*/
              $(window).scroll(function(){
                changeCSS();
              });

              element.hover(function(event){
                element.stop(true,false).animate(
                mouseOverCss,
                {'duration':opt.speed/10});
                //element.stop();
                //element.animate({'marginLeft':'0'}, {'duration':speed/10});
              });

              /* CSSを変更 */
              function changeCSS(){
                  /* 要素の幅・高さを取得 */
                  var imageWidth = element.width();
                  var imageHeight = element.height();
                  /* ウィンドウの幅・高さを取得 */
                  var windowWidth = $(window).width();
                  var windowHeight = window.innerHeight;
                  var windowTop = $(document).scrollTop();
                  /* 要素のスタイルを変更（要素を常に画面中央に配置） */
                  $(element).css({
                      "position" : "absolute",
                      "left" : 0 - imageWidth,
                      "top" : windowHeight /2 - imageHeight / 2 + windowTop
                  });
              };
              function cloudMove(){
              var imageWidth = element.width();
              element
                .animate(normalMoveCss['first_pos'] ,{'duration':opt.speed, 'easing':'swing'})
                .animate(normalMoveCss['first_pos'] ,{'duration':opt.speed, 'easing':'swing'})
                .animate(normalMoveCss['second_pos'] ,{'duration':opt.speed*1.5, 'easing':'swing'})
                //.animate({'marginLeft':imageWidth*opt.first_show},{'duration':opt.speed, 'easing':'swing'})
                //.animate({'marginLeft':imageWidth*opt.first_show},{'duration':opt.speed, 'easing':'swing'})
                //.animate({'marginLeft':imageWidth*opt.second_show},{'duration':opt.speed*1.5, 'easing':'swing'})
                //.animate({'marginLeft':'0'}, {'duration':speed/10});
              };
          };
      })(jQuery);
      /*
      (function($){
        $.fn.nepnyan = function(){
          this.animate({
            ''marginLeft'':'100px'
          });
        };
      }(jQuery));
      */

    </script>
  </head>
  <body>
    <div id ="hoge">
      <img src = "http://www.city.hikone.shiga.jp/kikakushinkobu/400ht/img/hikonyan_seiza.jpg"alt="hikonyan">
    </div>
    <div style= "height:4000px;"></div>
  </body>
</html>
